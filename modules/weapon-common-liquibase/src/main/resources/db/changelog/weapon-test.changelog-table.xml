<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:pro="http://www.liquibase.org/xml/ns/pro" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-3.8.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">


    <changeSet author="nash5 (generated)" id="1630566618258-2">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="pipe_task"/>
            </not>
        </preConditions>
        <createTable tableName="pipe_task">
            <column name="id" remarks="主键" type="VARCHAR(50)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" remarks="任务名称" type="VARCHAR(50)">
                <constraints unique="true"/>
            </column>
            <column name="code" remarks="任务编号" type="VARCHAR(10)"/>
            <column name="description" remarks="任务内容" type="VARCHAR(1000)"/>
            <column name="startTime" remarks="开始时间" type="datetime"/>
            <column name="createTime" remarks="创建时间" type="datetime"/>
            <column name="modifyTime" remarks="修改时间" type="datetime"/>
            <column name="endTime" remarks="结束时间" type="datetime"/>
            <column name="creator" remarks="创建人" type="VARCHAR(50)"/>
            <column name="disabled" remarks="废弃标志" type="TINYINT(3)"/>
            <column name="status" remarks="运行状态, 0: 未执行, 1: 执行中, 2: 执行完" type="TINYINT(3)"/>
        </createTable>
    </changeSet>
    <changeSet author="nash5 (generated)" id="1630566618258-3">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="pipe_test"/>
            </not>
        </preConditions>
        <createTable tableName="pipe_test">
            <column name="id" remarks="主键" type="VARCHAR(50)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" remarks="测试名称" type="VARCHAR(50)">
                <constraints unique="true"/>
            </column>
            <column name="code" remarks="测试编号" type="VARCHAR(10)"/>
            <column name="type" remarks="测试类别(单武器通道测试, 自动防御系统测试)" type="VARCHAR(50)"/>
            <column name="createTime" remarks="创建时间" type="datetime"/>
            <column name="modifyTime" remarks="修改时间" type="datetime"/>
            <column name="creator" remarks="创建人" type="VARCHAR(50)"/>
            <column name="sortKey" remarks="排序字段" type="INT"/>
            <column name="threshold" remarks="阈值, eg: [{&quot;time&quot;: &quot;5&quot;, ...}]" type="VARCHAR(100)"/>
            <column name="disabled" remarks="废弃字段" type="TINYINT(3)"/>
            <column name="status" remarks="运行状态, 0: 未执行, 1: 执行中, 2: 执行完" type="TINYINT(3)"/>
            <column name="taskId" remarks="外键-任务id" type="VARCHAR(50)"/>
        </createTable>
    </changeSet>
    <changeSet author="nash5 (generated)" id="1630566618258-4">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="pipe_self_check"/>
            </not>
        </preConditions>
        <createTable tableName="pipe_self_check">
            <column name="id" remarks="主键" type="VARCHAR(50)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="name" remarks="装备名称" type="VARCHAR(50)">
                <constraints unique="true"/>
            </column>
            <column name="showName" remarks="显示名称, 供前端调用" type="VARCHAR(50)"/>
            <column name="code" remarks="装备编号" type="VARCHAR(10)"/>
            <column name="hasErr" remarks="该装备对应的显示名称是否有Err" type="TINYINT(3)"/>
            <column name="createTime" remarks="创建时间" type="datetime"/>
            <column name="modifyTime" remarks="修改时间" type="datetime"/>
            <column name="creator" remarks="创建人" type="VARCHAR(50)"/>
            <column name="sortKey" remarks="排序字段" type="INT"/>
            <column name="disabled" remarks="废弃字段" type="TINYINT(3)"/>
            <column name="taskId" remarks="外键-任务id" type="VARCHAR(50)"/>
        </createTable>
    </changeSet>
    <changeSet author="nash5 (generated)" id="1630566618258-5">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="pipe_advice"/>
            </not>
        </preConditions>
        <createTable tableName="pipe_advice">
            <column name="id" remarks="主键" type="VARCHAR(50)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="l1Name" remarks="测试项(1级)名称" type="VARCHAR(50)"/>
            <column name="l2Name" remarks="测试项子项(2级)名称" type="VARCHAR(50)"/>
            <column name="l2HasErr" remarks="l2是否有Err" type="TINYINT(3)"/>
            <column name="advice" remarks="对策建议" type="VARCHAR(10000)"/>
            <column name="createTime" remarks="创建时间" type="datetime"/>
            <column name="modifyTime" remarks="修改时间" type="datetime"/>
            <column name="creator" remarks="创建人" type="VARCHAR(50)"/>
            <column name="sortKey" remarks="排序字段" type="INT"/>
            <column name="disabled" remarks="废弃字段" type="TINYINT(3)"/>
        </createTable>
    </changeSet>

    <changeSet author="nash5 (generated)" id="1630566618258-1">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="pipe_history"/>
            </not>
        </preConditions>
        <createTable tableName="pipe_history">
            <column name="id" remarks="主键" type="VARCHAR(50)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="res" remarks="对策建议" type="MEDIUMBLOB"/>
            <column name="createTime" remarks="创建时间" type="datetime"/>
            <column name="modifyTime" remarks="修改时间" type="datetime"/>
            <column name="creator" remarks="创建人" type="VARCHAR(50)"/>
            <column name="sortKey" remarks="排序字段" type="INT"/>
            <column name="disabled" remarks="废弃字段" type="TINYINT(3)"/>
            <column name="taskId" remarks="外键-任务id" type="VARCHAR(50)"/>
            <column name="pipeTestId" remarks="外键-测试项id" type="VARCHAR(50)"/>
        </createTable>
    </changeSet>
    <changeSet author="nash5 (generated)" id="1630566618258-6">
        <createIndex indexName="pipeTestId" tableName="pipe_history">
            <column name="pipeTestId"/>
        </createIndex>
    </changeSet>
    <changeSet author="nash5 (generated)" id="1630566618258-7">
        <createIndex indexName="taskId" tableName="pipe_history">
            <column name="taskId"/>
        </createIndex>
    </changeSet>
    <changeSet author="nash5 (generated)" id="1630566618258-8">
        <createIndex indexName="taskId" tableName="pipe_test">
            <column name="taskId"/>
        </createIndex>
    </changeSet>
    <changeSet author="nash5 (generated)" id="1630566618258-9">
        <createIndex indexName="taskId" tableName="pipe_self_check">
            <column name="taskId"/>
        </createIndex>
    </changeSet>

    <changeSet author="nash5 (generated)" id="1630566618258-11">
        <addForeignKeyConstraint baseColumnNames="taskId" baseTableName="pipe_history" constraintName="pipe_history_ibfk_1" deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="id" referencedTableName="pipe_task" validate="true"/>
    </changeSet>
    <changeSet author="nash5 (generated)" id="1630566618258-12">
        <addForeignKeyConstraint baseColumnNames="pipeTestId" baseTableName="pipe_history" constraintName="pipe_history_ibfk_2" deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="id" referencedTableName="pipe_test" validate="true"/>
    </changeSet>
    <changeSet author="nash5 (generated)" id="1630566618258-13">
        <addForeignKeyConstraint baseColumnNames="taskId" baseTableName="pipe_test" constraintName="pipe_test_ibfk_1" deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="id" referencedTableName="pipe_task" validate="true"/>
    </changeSet>
    <changeSet author="nash5 (generated)" id="1630566618258-14">
        <addForeignKeyConstraint baseColumnNames="taskId" baseTableName="pipe_self_check" constraintName="pipe_self_check_ibfk_1" deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="RESTRICT" referencedColumnNames="id" referencedTableName="pipe_task" validate="true"/>
    </changeSet>

    <changeSet id="1630566618258-15" author="xinlai">
        <sqlFile path="pipe_advice.sql"/>
    </changeSet>

</databaseChangeLog>
